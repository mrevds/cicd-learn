<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/.github/workflows/deploy.yml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/.github/workflows/deploy.yml" />
              <option name="originalContent" value="name: CI/CD Pipeline&#10;&#10;on:&#10;  push:&#10;    branches: [ &quot;main&quot; ]&#10;  pull_request:&#10;    branches: [ &quot;main&quot; ]&#10;&#10;jobs:&#10;  test:&#10;    runs-on: ubuntu-latest&#10;    steps:&#10;      - name: Checkout code&#10;        uses: actions/checkout@v4&#10;&#10;      - name: Set up Go&#10;        uses: actions/setup-go@v4&#10;        with:&#10;          go-version: '1.20'&#10;&#10;      - name: Run tests&#10;        run: go test -v ./...&#10;&#10;  build-and-deploy:&#10;    needs: test&#10;    runs-on: ubuntu-latest&#10;    if: github.ref == 'refs/heads/main' &amp;&amp; github.event_name == 'push'&#10;&#10;    steps:&#10;      - name: Checkout code&#10;        uses: actions/checkout@v4&#10;&#10;      - name: Set up Docker Buildx&#10;        uses: docker/setup-buildx-action@v3&#10;&#10;      - name: Login to DockerHub&#10;        uses: docker/login-action@v3&#10;        with:&#10;          username: ${{ secrets.DOCKERHUB_USERNAME }}&#10;          password: ${{ secrets.DOCKERHUB_TOKEN }}&#10;&#10;      - name: Build and push Docker image&#10;        uses: docker/build-push-action@v5&#10;        with:&#10;          context: .&#10;          push: true&#10;          tags: |&#10;            ${{ secrets.DOCKERHUB_USERNAME }}/learncicd:latest&#10;            ${{ secrets.DOCKERHUB_USERNAME }}/learncicd:${{ github.sha }}&#10;          cache-from: type=gha&#10;          cache-to: type=gha,mode=max&#10;&#10;      - name: Deploy to server&#10;        uses: appleboy/ssh-action@v1.0.3&#10;        with:&#10;          host: ${{ secrets.SERVER_IP }}&#10;          username: ${{ secrets.SERVER_USER }}&#10;          key: ${{ secrets.SERVER_SSH_KEY }}&#10;          script: |&#10;            # Останавливаем и удаляем старый контейнер&#10;            docker stop learncicd || true&#10;            docker rm learncicd || true&#10;            &#10;            # Очищаем старые образы&#10;            docker image prune -f&#10;            &#10;            # Загружаем новый образ&#10;            docker pull ${{ secrets.DOCKERHUB_USERNAME }}/learncicd:latest&#10;            &#10;            # Запускаем новый контейнер&#10;            docker run -d \&#10;              --name learncicd \&#10;              --restart unless-stopped \&#10;              -p 8080:8080 \&#10;              ${{ secrets.DOCKERHUB_USERNAME }}/learncicd:latest&#10;            &#10;            # Проверяем что контейнер запустился&#10;            sleep 5&#10;            docker ps | grep learncicd&#10;" />
              <option name="updatedContent" value="name: CI/CD Pipeline&#10;&#10;on:&#10;  push:&#10;    branches: [ &quot;main&quot; ]&#10;  pull_request:&#10;    branches: [ &quot;main&quot; ]&#10;&#10;jobs:&#10;  test:&#10;    runs-on: ubuntu-latest&#10;    steps:&#10;      - name: Checkout code&#10;        uses: actions/checkout@v4&#10;&#10;      - name: Set up Go&#10;        uses: actions/setup-go@v4&#10;        with:&#10;          go-version: '1.20'&#10;&#10;      - name: Run tests&#10;        run: go test -v ./...&#10;&#10;  build-and-deploy:&#10;    needs: test&#10;    runs-on: ubuntu-latest&#10;    if: github.ref == 'refs/heads/main' &amp;&amp; github.event_name == 'push'&#10;&#10;    steps:&#10;      - name: Checkout code&#10;        uses: actions/checkout@v4&#10;&#10;      - name: Set up Docker Buildx&#10;        uses: docker/setup-buildx-action@v3&#10;&#10;      - name: Login to DockerHub&#10;        uses: docker/login-action@v3&#10;        with:&#10;          username: ${{ secrets.DOCKERHUB_USERNAME }}&#10;          password: ${{ secrets.DOCKERHUB_TOKEN }}&#10;&#10;      - name: Build and push Docker image&#10;        uses: docker/build-push-action@v5&#10;        with:&#10;          context: .&#10;          push: true&#10;          tags: |&#10;            ${{ secrets.DOCKERHUB_USERNAME }}/learncicd:latest&#10;            ${{ secrets.DOCKERHUB_USERNAME }}/learncicd:${{ github.sha }}&#10;          cache-from: type=gha&#10;          cache-to: type=gha,mode=max&#10;&#10;      - name: Deploy to server&#10;        uses: appleboy/ssh-action@v1.0.3&#10;        with:&#10;          host: ${{ secrets.SERVER_IP }}&#10;          username: ${{ secrets.SERVER_USER }}&#10;          key: ${{ secrets.SERVER_SSH_KEY }}&#10;          script: |&#10;            # Останавливаем и удаляем старый контейнер&#10;            docker stop learncicd || true&#10;            docker rm learncicd || true&#10;            &#10;            # Очищаем старые образы&#10;            docker image prune -f&#10;            &#10;            # Загружаем новый образ&#10;            docker pull ${{ secrets.DOCKERHUB_USERNAME }}/learncicd:latest&#10;            &#10;            # Запускаем новый контейнер&#10;            docker run -d \&#10;              --name learncicd \&#10;              --restart unless-stopped \&#10;              -p 8080:8080 \&#10;              ${{ secrets.DOCKERHUB_USERNAME }}/learncicd:latest&#10;            &#10;            # Проверяем что контейнер запустился&#10;            sleep 5&#10;            docker ps | grep learncicd&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Dockerfile">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Dockerfile" />
              <option name="originalContent" value="FROM golang:1.20-alpine AS builder&#10;&#10;# Устанавливаем git и другие зависимости&#10;RUN apk add --no-cache git&#10;&#10;WORKDIR /app&#10;COPY go.mod go.sum ./&#10;RUN go mod download&#10;&#10;COPY . .&#10;&#10;# Запускаем тесты&#10;RUN go test -v ./...&#10;&#10;# Собираем статически (важно для Alpine)&#10;RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o app .&#10;&#10;# Финальный образ&#10;FROM alpine:latest&#10;&#10;# Добавляем сертификаты и timezone данные&#10;RUN apk --no-cache add ca-certificates tzdata&#10;WORKDIR /root/&#10;&#10;# Копируем собранное приложение&#10;COPY --from=builder /app/app .&#10;&#10;EXPOSE 8080&#10;&#10;CMD [&quot;./app&quot;]" />
              <option name="updatedContent" value="FROM golang:1.20-alpine AS builder&#10;&#10;# Устанавливаем git и другие зависимости&#10;RUN apk add --no-cache git&#10;&#10;WORKDIR /app&#10;COPY go.mod go.sum ./&#10;RUN go mod download&#10;&#10;COPY . .&#10;&#10;# Запускаем тесты&#10;RUN go test -v ./...&#10;&#10;# Собираем статически (важно для Alpine)&#10;RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o app .&#10;&#10;# Финальный образ&#10;FROM alpine:latest&#10;&#10;# Добавляем сертификаты и timezone данные&#10;RUN apk --no-cache add ca-certificates tzdata&#10;WORKDIR /root/&#10;&#10;# Копируем собранное приложение&#10;COPY --from=builder /app/app .&#10;&#10;EXPOSE 8080&#10;&#10;CMD [&quot;./app&quot;]" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>